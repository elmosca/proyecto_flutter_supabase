---
alwaysApply: true
---
## üåç INTERNACIONALIZACI√ìN (I18N)

### **4. CONFIGURACI√ìN OBLIGATORIA**
- **Idioma principal**: Espa√±ol (es)
- **Idiomas soportados**: Espa√±ol, Ingl√©s (en)
- **Formato**: Archivos ARB (.arb) para cada idioma
- **Ubicaci√≥n**: `lib/l10n/`

### **5. REGLAS DE I18N**
- ‚úÖ **SIEMPRE** usar `AppLocalizations.of(context)` para textos
- ‚úÖ **NUNCA** hardcodear strings en espa√±ol o ingl√©s
- ‚úÖ **SIEMPRE** incluir descripci√≥n en metadatos ARB
- ‚úÖ **SIEMPRE** usar claves descriptivas y consistentes
- ‚úÖ **SIEMPRE** considerar pluralizaci√≥n y formatos de fecha/n√∫mero

### **5.1. PROHIBICI√ìN ABSOLUTA DE HARDCODEO DE TEXTO**
- üö® **PROHIBIDO** hardcodear cualquier texto visible al usuario
- üö® **PROHIBIDO** usar strings literales en widgets de UI
- üö® **PROHIBIDO** hardcodear mensajes de error, validaci√≥n o notificaci√≥n
- üö® **PROHIBIDO** usar texto en botones, etiquetas, t√≠tulos o descripciones
- üö® **PROHIBIDO** hardcodear texto en comentarios de c√≥digo que sea visible al usuario
- ‚úÖ **OBLIGATORIO** usar claves de internacionalizaci√≥n para TODO texto visible
- ‚úÖ **OBLIGATORIO** a√±adir nuevas claves a los archivos ARB cuando sea necesario

### **6. EJEMPLOS DE USO CORRECTO E INCORRECTO**
```dart
// ‚úÖ CORRECTO - Usando internacionalizaci√≥n
Text(AppLocalizations.of(context)!.welcome)
Text(AppLocalizations.of(context)!.loginButton)
Text(AppLocalizations.of(context)!.errorMessage)
ElevatedButton(
  onPressed: () {},
  child: Text(AppLocalizations.of(context)!.save),
)

// ‚ùå INCORRECTO - Hardcodeo prohibido
Text('Bienvenido')
Text('Welcome')
Text('Iniciar Sesi√≥n')
Text('Error: Usuario no encontrado')
Text('Guardar')
Text('Cancelar')
Text('Confirmar')
Text('Eliminar')
Text('Editar')
Text('A√±adir')
Text('Buscar')
Text('Filtrar')
Text('Cargando...')
Text('No hay datos')
Text('Int√©ntalo de nuevo')
```

### **7. ESTRUCTURA DE ARCHIVOS ARB**
```json
{
  "@@locale": "es",
  "key": "Valor en espa√±ol",
  "@key": {
    "description": "Descripci√≥n del contexto de uso"
  }
}
```

---

## üîß DESARROLLO FLUTTER

### **8. VERSIONES Y DEPENDENCIAS**
- **Flutter SDK**: ^3.8.1 (√∫ltima estable)
- **Dart**: ^3.8.1
- **Supabase**: ^2.10.0
- **BLoC**: ^9.1.1
- **GoRouter**: ^16.2.0

### **9. REGLAS DE C√ìDIGO**
- **Null Safety**: Usar siempre null safety
- **Const Constructors**: Usar `const` cuando sea posible
- **Async/Await**: Preferir `async/await` sobre `.then()`
- **Error Handling**: Siempre manejar errores con try-catch
- **Type Safety**: Usar tipos expl√≠citos, evitar `dynamic`

### **10. ESTILO DE C√ìDIGO**
- **Indentaci√≥n**: 2 espacios
- **Longitud de l√≠nea**: M√°ximo 80 caracteres
- **Nombres**: camelCase para variables, PascalCase para clases
- **Comentarios**: Documentar funciones p√∫blicas y complejas

### **11. EJEMPLO DE C√ìDIGO CORRECTO**
```dart
class UserService {
  static const String _baseUrl = 'api/users';
  
  Future<User?> getUserById(String id) async {
    try {
      final response = await _httpClient.get('$_baseUrl/$id');
      return User.fromJson(response.data);
    } catch (e) {
      debugPrint('Error fetching user: $e');
      return null;
    }
  }
}
```

---

## üóÑÔ∏è BACKEND SUPABASE

### **12. CONFIGURACI√ìN DE BASE DE DATOS**
- **RLS (Row Level Security)**: SIEMPRE habilitado
- **Pol√≠ticas de seguridad**: Por rol y usuario
- **Triggers**: Para auditor√≠a y validaciones
- **Funciones**: Para l√≥gica de negocio compleja

### **13. REGLAS DE SEGURIDAD**
- ‚úÖ **SIEMPRE** usar RLS en todas las tablas
- ‚úÖ **SIEMPRE** validar permisos por rol
- ‚úÖ **SIEMPRE** usar pol√≠ticas granulares
- ‚úÖ **NUNCA** exponer datos sensibles sin autenticaci√≥n

### **14. EJEMPLO DE POL√çTICA RLS**
```sql
-- Pol√≠tica para proyectos (solo el propietario puede ver)
CREATE POLICY "Users can view own projects" ON projects
  FOR SELECT USING (auth.uid() = user_id);

-- Pol√≠tica para tutores (pueden ver proyectos asignados)
CREATE POLICY "Tutors can view assigned projects" ON projects
  FOR SELECT USING (
    auth.uid() IN (
      SELECT tutor_id FROM project_assignments 
      WHERE project_id = id
    )
  );
```

---

## üì± INTERFACES DE USUARIO

### **15. PRINCIPIOS DE UI/UX**
- **Material Design 3**: Usar componentes modernos
- **Responsive Design**: Adaptar a diferentes tama√±os de pantalla
- **Accessibility**: Incluir soporte para lectores de pantalla
- **Dark/Light Theme**: Soporte para temas (futuro)

### **16. COMPONENTES REUTILIZABLES**
- **Botones**: Usar `ElevatedButton`, `TextButton` consistentemente
- **Campos de texto**: Usar `TextFormField` con validaci√≥n
- **Di√°logos**: Usar `showDialog` con `AlertDialog`
- **Loading**: Usar `CircularProgressIndicator` para operaciones as√≠ncronas

### **17. EJEMPLO DE WIDGET REUTILIZABLE**
```dart
class CustomButton extends StatelessWidget {
  final String text;
  final VoidCallback? onPressed;
  final bool isLoading;
  
  const CustomButton({
    super.key,
    required this.text,
    this.onPressed,
    this.isLoading = false,
  });

  @override
  Widget build(BuildContext context) {
    return ElevatedButton(
      onPressed: isLoading ? null : onPressed,
      child: isLoading 
        ? const CircularProgressIndicator()
        : Text(text),
    );
  }
}
```

---

## üß™ TESTING Y CALIDAD

### **18. TIPOS DE TESTING**
- **Unit Tests**: Para l√≥gica de negocio (BLoCs, servicios)
- **Widget Tests**: Para componentes de UI
- **Integration Tests**: Para flujos completos
- **Golden Tests**: Para comparaci√≥n visual (futuro)

### **19. REGLAS DE TESTING**
- ‚úÖ **SIEMPRE** escribir tests para BLoCs
- ‚úÖ **SIEMPRE** mockear servicios externos
- ‚úÖ **SIEMPRE** probar casos de error
- ‚úÖ **SIEMPRE** mantener cobertura >80%

### **20. REGLAS CR√çTICAS DE GENERACI√ìN DE C√ìDIGO**
- ‚úÖ **NUNCA** generar c√≥digo que produzca errores, aunque compile
- ‚úÖ **SIEMPRE** usar la documentaci√≥n oficial del lenguaje para generar c√≥digo correcto
- ‚úÖ **SIEMPRE** verificar que el c√≥digo generado sigue las mejores pr√°cticas del lenguaje
- ‚úÖ **SIEMPRE** generar c√≥digo que pase `flutter analyze` sin errores
- ‚úÖ **NUNCA** sacrificar calidad por velocidad de generaci√≥n
- ‚úÖ **SIEMPRE** generar c√≥digo que sea mantenible y legible
- ‚úÖ **SIEMPRE** usar patrones est√°ndar y reconocidos del lenguaje
- ‚úÖ **NUNCA** generar c√≥digo "que funciona" pero viola principios del lenguaje

### **21. EJEMPLO DE TEST**
```dart
void main() {
  group('UserBloc Tests', () {
    late UserBloc userBloc;
    late MockUserService mockUserService;

    setUp(() {
      mockUserService = MockUserService();
      userBloc = UserBloc(userService: mockUserService);
    });

    test('emits [UserLoading, UserLoaded] when user is fetched', () async {
      when(mockUserService.getUser()).thenAnswer(
        (_) async => User(id: '1', name: 'Test'),
      );

      expect(userBloc.stream, emitsInOrder([
        UserLoading(),
        UserLoaded(User(id: '1', name: 'Test')),
      ]));

      userBloc.add(FetchUser());
    });
  });
}
```

---

## üì¶ GESTI√ìN DE DEPENDENCIAS

### **22. REGLAS DE DEPENDENCIAS**
- **Producci√≥n**: Solo dependencias necesarias
- **Desarrollo**: Herramientas de testing y linting
- **Versiones**: Usar rangos de versiones compatibles
- **Actualizaciones**: Revisar mensualmente con `flutter pub outdated`

### **23. DEPENDENCIAS OBLIGATORIAS**
```yaml
dependencies:
  flutter:
    sdk: flutter
  supabase_flutter: ^2.10.0      # Backend
  flutter_bloc: ^9.1.1          # Estado
  go_router: ^16.2.0            # Navegaci√≥n
  flutter_localizations:         # I18n
    sdk: flutter
  intl: ^0.20.2                 # Formateo I18n
  shared_preferences: ^2.2.2     # Storage local

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^5.0.0         # Linting
  build_runner: ^2.7.0          # Code generation
  json_serializable: ^6.11.0    # Serializaci√≥n
```

---

## üîí SEGURIDAD Y PRIVACIDAD

### **24. PRINCIPIOS DE SEGURIDAD**
- **Autenticaci√≥n**: Usar Supabase Auth
- **Autorizaci√≥n**: RLS + pol√≠ticas de base de datos
- **Validaci√≥n**: Validar datos en frontend y backend
- **Sanitizaci√≥n**: Sanitizar inputs del usuario
- **HTTPS**: Siempre usar conexiones seguras

### **25. MANEJO DE DATOS SENSIBLES**
- **API Keys**: NUNCA en c√≥digo fuente
- **Variables de entorno**: Usar archivos .env
- **Secrets**: Usar Supabase secrets management
- **Logs**: NUNCA loggear datos sensibles

---

## üìä MONITOREO Y LOGGING

### **26. LOGGING**
- **Niveles**: debug, info, warning, error
- **Contexto**: Incluir informaci√≥n relevante
- **Sensibilidad**: NUNCA loggear datos personales
- **Performance**: Usar `kDebugMode` para logs de desarrollo

### **27. EJEMPLO DE LOGGING**
```dart
if (kDebugMode) {
  debugPrint('üîê User authentication attempt: ${user.email}');
}

// Para errores
try {
  await _performOperation();
} catch (e, stackTrace) {
  debugPrint('‚ùå Operation failed: $e');
  debugPrint('üìö Stack trace: $stackTrace');
  rethrow;
}
```

---

## üöÄ DESPLIEGUE Y CI/CD

### **28. ENTORNOS**
- **Development**: Local con Supabase local
- **Staging**: Supabase cloud con datos de prueba
- **Production**: Supabase cloud con datos reales

### **29. CONFIGURACI√ìN POR ENTORNO**
```dart
class AppConfig {
  static const String supabaseUrl = String.fromEnvironment(
    'SUPABASE_URL',
    defaultValue: 'http://localhost:54321',
  );
  
  static const String supabaseAnonKey = String.fromEnvironment(
    'SUPABASE_ANON_KEY',
    defaultValue: 'your-anon-key',
  );
}
```

---

## üìö DOCUMENTACI√ìN

### **30. DOCUMENTACI√ìN OBLIGATORIA**
- **README.md**: Descripci√≥n del proyecto y setup
- **API.md**: Documentaci√≥n de endpoints
- **ARCHITECTURE.md**: Decisiones de arquitectura
- **DEPLOYMENT.md**: Gu√≠a de despliegue
- **CONTRIBUTING.md**: Gu√≠a para contribuidores

### **31. COMENTARIOS EN C√ìDIGO**
- **Funciones p√∫blicas**: Documentar par√°metros y retorno
- **Clases complejas**: Explicar prop√≥sito y uso
- **L√≥gica de negocio**: Comentar decisiones importantes
- **TODO**: Marcar tareas pendientes

---

## üéØ CHECKLIST DE IMPLEMENTACI√ìN

### **32. ANTES DE COMMIT**
- [ ] C√≥digo compila sin errores
- [ ] Tests pasan
- [ ] Linting sin warnings cr√≠ticos
- [ ] **VERIFICACI√ìN I18N**: No hay texto hardcodeado en widgets
- [ ] **VERIFICACI√ìN I18N**: Todos los textos usan `AppLocalizations.of(context)`
- [ ] **VERIFICACI√ìN I18N**: Nuevas claves a√±adidas a archivos ARB
- [ ] Internacionalizaci√≥n implementada
- [ ] Documentaci√≥n actualizada
- [ ] Seguridad verificada

### **33. ANTES DE MERGE**
- [ ] Code review aprobado
- [ ] Tests de integraci√≥n pasan
- [ ] Build exitoso en CI/CD
- [ ] Documentaci√≥n actualizada
- [ ] Changelog actualizado

---

## üîó ENLACES OFICIALES

### **34. DOCUMENTACI√ìN FLUTTER**
- **Flutter**: https://docs.flutter.dev/
- **Dart**: https://dart.dev/guides
- **Flutter Localizations**: https://docs.flutter.dev/development/accessibility-and-localization/internationalization

### **35. DOCUMENTACI√ìN SUPABASE**
- **Supabase**: https://supabase.com/docs
- **Supabase Flutter**: https://supabase.com/docs/reference/dart
- **RLS**: https://supabase.com/docs/guides/auth/row-level-security

### **36. DOCUMENTACI√ìN BLoC**
- **Flutter BLoC**: https://bloclibrary.dev/
- **BLoC Pattern**: https://bloclibrary.dev/#/coreconcepts

---

## üö® VIOLACIONES CR√çTICAS

### **37. NUNCA PERMITIR**
- ‚ùå **CR√çTICO**: Hardcodear strings sin internacionalizaci√≥n
- ‚ùå **CR√çTICO**: Usar texto literal en cualquier widget de UI
- ‚ùå **CR√çTICO**: Hardcodear mensajes de error, validaci√≥n o notificaci√≥n
- ‚ùå **CR√çTICO**: Usar strings literales en botones, etiquetas o t√≠tulos
- ‚ùå Deshabilitar RLS en producci√≥n
- ‚ùå Exponer API keys en c√≥digo
- ‚ùå Ignorar errores de linting cr√≠ticos
- ‚ùå Committear archivos .env con credenciales reales
- ‚ùå Usar `print()` en lugar de `debugPrint()`

### **38. CONSECUENCIAS**
- **Primera vez**: Advertencia y correcci√≥n
- **Segunda vez**: Revisi√≥n de c√≥digo obligatoria
- **Tercera vez**: Bloqueo temporal de commits

---

## üìù NOTAS IMPORTANTES

### **39. ACTUALIZACIONES**
- Este archivo se actualiza con cada cambio importante
- Revisar mensualmente para mantener actualizado
- Consultar documentaci√≥n oficial para cambios

### **40. EXCEPCIONES**
- Las excepciones a estas reglas requieren aprobaci√≥n del equipo
- Documentar justificaci√≥n de excepciones
- Revisar excepciones en retrospectivas

---

## üö® **REGLAS CR√çTICAS DE CALIDAD DE C√ìDIGO**

### **41. PRINCIPIOS FUNDAMENTALES**
- ‚úÖ **NUNCA** generar c√≥digo que viole las reglas del lenguaje
- ‚úÖ **SIEMPRE** usar la documentaci√≥n oficial como fuente de verdad
- ‚úÖ **SIEMPRE** generar c√≥digo que pase `flutter analyze` sin errores
- ‚úÖ **NUNCA** sacrificar calidad por velocidad de implementaci√≥n

### **42. EST√ÅNDARES DE C√ìDIGO GENERADO**
- ‚úÖ **Sintaxis**: 100% correcta seg√∫n especificaci√≥n del lenguaje
- ‚úÖ **Patrones**: Usar patrones est√°ndar y reconocidos
- ‚úÖ **Estructura**: Seguir convenciones del lenguaje
- ‚úÖ **Nombres**: Usar nomenclatura est√°ndar y descriptiva
- ‚úÖ **Documentaci√≥n**: Incluir comentarios cuando sea necesario

### **43. VERIFICACI√ìN OBLIGATORIA**
- ‚úÖ **Antes de generar**: Consultar documentaci√≥n oficial
- ‚úÖ **Despu√©s de generar**: Verificar con `flutter analyze`
- ‚úÖ **Antes de commit**: C√≥digo debe compilar sin warnings cr√≠ticos
- ‚úÖ **Antes de merge**: C√≥digo debe pasar todos los tests

### **44. RECURSOS OBLIGATORIOS PARA GENERACI√ìN**
- **Flutter**: https://docs.flutter.dev/
- **Dart**: https://dart.dev/guides
- **Supabase Flutter**: https://supabase.com/docs/reference/dart
- **Flutter BLoC**: https://bloclibrary.dev/
- **Material Design**: https://m3.material.io/

### **45. CONSECUENCIAS DE VIOLACI√ìN**
- **Primera vez**: Correcci√≥n inmediata obligatoria
- **Segunda vez**: Revisi√≥n de c√≥digo obligatoria
- **Tercera vez**: Bloqueo temporal de commits
- **Reincidencia**: Revisi√≥n del proceso de desarrollo

---

**¬°Recuerda: La calidad del c√≥digo es responsabilidad de todos! üöÄ**

---

## üéØ CONFIGURACI√ìN DE APLICACI√ìN

### **46. DESCRIPCI√ìN DE LA REGLA**
Esta regla se aplica autom√°ticamente a todo el proyecto Flutter + Supabase FCT para mantener consistencia en:
- Arquitectura BLoC y patrones de dise√±o
- Internacionalizaci√≥n obligatoria (espa√±ol/ingl√©s)
- Est√°ndares de c√≥digo Flutter/Dart
- Seguridad con Supabase y RLS
- Calidad de c√≥digo y testing
- Documentaci√≥n y mejores pr√°cticas

### **47. AUTO ATTACHMENTS**
- **Archivos**: `**/*.dart`, `**/*.sql`, `**/*.md`, `**/*.yaml`, `**/*.json`
- **Directorios**: `frontend/`, `backend/`, `docs/`, `lib/`, `test/`
- **Contexto**: Siempre que se abra cualquier archivo del proyecto
- **Activaci√≥n**: Autom√°tica en todo el workspace del proyecto

### **48. ALCANCE DE APLICACI√ìN**
- ‚úÖ **Frontend Flutter**: Todos los archivos .dart
- ‚úÖ **Backend Supabase**: Migraciones, funciones, pol√≠ticas
- ‚úÖ **Configuraci√≥n**: pubspec.yaml, an√°lisis, CI/CD
- ‚úÖ **Documentaci√≥n**: README, gu√≠as, especificaciones
- ‚úÖ **Testing**: Tests unitarios, de widget e integraci√≥n

---

**¬°Esta regla garantiza la calidad y consistencia en todo el proyecto! üöÄ**
description: Reglas espec√≠ficas para el proyecto Flutter + Supabase FCT que se aplican autom√°ticamente a todo el c√≥digo para mantener arquitectura BLoC, internacionalizaci√≥n, seguridad y calidad de c√≥digo.
globs: ["**/*.dart", "**/*.sql", "**/*.md", "**/*.yaml", "**/*.json", "frontend/**", "backend/**", "docs/**", "lib/**", "test/**"]
alwaysApply: true
---
